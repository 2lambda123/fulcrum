<script type="text/javascript">
$(function() {
  var project = new Project({"project":{"iteration_length":1,"last_changeset_id":123,"iteration_start_day":1,"point_values":[0,1,2,3,5,8],"default_velocity":10,"id":999999,"start_date":"2012/03/08"}});
  project.users.reset([{"user":{"name":"Test User","email":"test@example.com","initials":"TU","id":1}}]);
  project.current_user = new User({"user":{"name":"Test User","email":"test@example.com","initials":"TU","id":1}});

  project.stories.fetch = function() {};
  window.project = project;

  var chilly_bin = $('#chilly_bin');
  var backlog = $('#backlog');
  var in_progress = $('#in_progress');

  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Unestimated feature","estimable":true}));
  appendStoryTo(chilly_bin, new Story({
    "id":1,"title":"Estimated feature","estimated":true,"estimate":3,
    "events":["start"]
  }));
  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Example chore","story_type":"chore"}));
  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Example bug","story_type":"bug"}));
  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Example release","story_type":"release"}));

  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Editing feature","editing":true}));
  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Editing chore","story_type":"chore","editing":true}));
  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Editing bug","story_type":"bug","editing":true}));
  appendStoryTo(chilly_bin,
    new Story({"id":1,"title":"Editing release","story_type":"release","editing":true}));

  appendStoryTo(backlog,
    new Story({"id":1,"title":"Unestimated feature","estimable":true}));
  appendStoryTo(backlog, new Story({
    "id":1,"title":"Estimated feature","estimated":true,"estimate":3,
    "events":["start"]
  }));
  appendStoryTo(backlog,
    new Story({"id":1,"title":"Example chore","story_type":"chore"}));
  appendStoryTo(backlog,
    new Story({"id":1,"title":"Example bug","story_type":"bug"}));
  appendStoryTo(backlog,
    new Story({"id":1,"title":"Example release","story_type":"release"}));

  appendStoryTo(in_progress,
    new Story({"id":1,"title":"Started feature","state":"started","estimate":3,
      "estimated":true, "events":["finish"]}));
  appendStoryTo(in_progress,
    new Story({"id":1,"title":"Finished feature","state":"finished",
      "estimate":3, "estimated":true, "events":["deliver"]}));
  appendStoryTo(in_progress, new Story({
    "id":1,"title":"Delivered feature","estimated":true,"estimate":3,
    "state":"delivered", "events":["accept","reject"]
  }));
  appendStoryTo(in_progress, new Story({
    "id":1,"title":"Rejected feature","estimated":true,"estimate":3,
    "events":["restart"]
  }));
  appendStoryTo(in_progress,
    new Story({"id":1,"title":"Example chore","story_type":"chore"}));
  appendStoryTo(in_progress,
    new Story({"id":1,"title":"Example bug","story_type":"bug"}));
  appendStoryTo(in_progress,
    new Story({"id":1,"title":"Example release","story_type":"release"}));

  function appendStoryTo(el, story) {
    story.collection = window.project.stories;
    var view = new StoryView({model:story});
    view.render();
    el.append(view.el);
  }

  window.projectView = new ProjectView({model: project});
  window.projectView.scaleToViewport();
  $(window).resize(projectView.scaleToViewport);

  window.projectView.notice({
    'title': 'Test card',
    'text': 'This is a testcard to expose the full UI on one page'
  });
});
</script>

<% content_for :title_bar do %>
  <div id="velocity" class="velocity"></div>
  <%= render :partial => 'projects/nav',
             :locals => {:project => @project, :show_column_toggles => true} %>
  | <a id="add_story" href="#">Add story</a>
<% end %>

<table class="stories" width="100%">
  <thead>
    <tr>
      <th class="done_column">Done<a class="toggle-column hide_done" title="Close">&times;</a></th>
      <th class="in_progress_column">In Progress<a class="toggle-column hide_in_progress" title="Close">&times;</a></th>
      <th class="backlog_column">Backlog<a class="toggle-column hide_backlog" title="Close">&times;</a></th>
      <th class="chilly_bin_column">Chilly Bin<a class="toggle-column hide_chilly_bin" title="Close">&times;</a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="done_column" style="width: 25%"><div id="done" class="storycolumn"></div></td>
      <td class="in_progress_column" style="width: 25%"><div id="in_progress" class="storycolumn sortable"></div></td>
      <td class="backlog_column" style="width: 25%"><div id="backlog" class="storycolumn sortable"></div></td>
      <td class="chilly_bin_column" style="width: 25%"><div id="chilly_bin" class="storycolumn sortable"></div></td>
    </tr>
  </tbody>
</table>
